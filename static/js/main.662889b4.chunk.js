(this["webpackJsonpencrypted-web-chat"]=this["webpackJsonpencrypted-web-chat"]||[]).push([[0],{180:function(e,t,n){e.exports=n(475)},185:function(e,t,n){},186:function(e,t,n){},337:function(e,t){},475:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(33),u=n.n(c),i=(n(185),n(22)),s=(n(186),n(28)),o=new(n(23).b)("4b8yshjzk88x"),l=(n(473),n(17)),p=n.n(l),d=n(52),m=n(20),b=n(174),f=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r,a,c,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=atob(t),a=new Uint8Array(Object(b.a)(r).map((function(e){return e.charCodeAt(0)}))),c={name:"AES-GCM",iv:(new TextEncoder).encode("Initialization Vector")},e.next=6,window.crypto.subtle.decrypt(c,n,a);case 6:return u=e.sent,e.abrupt("return",(new TextDecoder).decode(u));case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return","error decrypting message: ".concat(e.t0));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}(),v=function(e){var t=Object(r.useState)(e.message),n=Object(i.a)(t,2),c=n[0],u=n[1];return Object(r.useEffect)((function(){(function(){var t=Object(m.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=u,t.t1=d.a,t.t2={},t.t3=c,t.next=6,f(e.message.text,e.derivedKey);case 6:t.t4=t.sent,t.t5={text:t.t4},t.t6=(0,t.t1)(t.t2,t.t3,t.t5),(0,t.t0)(t.t6);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[e]),a.a.createElement(s.g,Object(d.a)({},e,{message:c}))},w=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r,a,c,u,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode(t),e.next=3,window.crypto.subtle.encrypt({name:"AES-GCM",iv:(new TextEncoder).encode("Initialization Vector")},n,r);case 3:return a=e.sent,c=new Uint8Array(a),u=String.fromCharCode.apply(null,c),i=btoa(u),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(e){var t=Object(r.useContext)(s.b),n=function(){var n=Object(m.a)(p.a.mark((function n(r,a){var c;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=d.a,n.t1={},n.t2=r,n.next=5,w(r.text,e.derivedKey);case 5:return n.t3=n.sent,n.t4={text:n.t3},c=(0,n.t0)(n.t1,n.t2,n.t4),n.next=10,t.channel.sendMessage(c);case 10:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return a.a.createElement(s.e,Object.assign({overrideSubmitHandler:n},e))},h=function(e){var t=Object(r.useState)(null),n=Object(i.a)(t,2),c=n[0],u=n[1];return Object(r.useEffect)((function(){u(o.channel("messaging",{members:[e.sender.sender,e.recipient.recipient]}))}),[e]),c?a.a.createElement(s.d,{client:o,theme:"messaging light"},a.a.createElement(s.a,{channel:c},a.a.createElement(s.i,null,a.a.createElement(s.c,null),a.a.createElement(s.f,{Message:function(t){return a.a.createElement(v,Object.assign({},t,{derivedKey:e.derivedKey}))}}),a.a.createElement(y,{derivedKey:e.derivedKey})),a.a.createElement(s.h,null))):a.a.createElement("div",null,"Loading...")},E=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.setUser({id:t,name:t,image:"https://getstream.io/random_png/?id=cool-recipe-9&name=".concat(t)},o.devToken(t));case 2:if(a=e.sent,!(null===(r=a.me)||void 0===r?void 0:r.publicKeyJwk)||a.me.publicKeyJwk==JSON.stringify(n.publicKeyJwk)){e.next=7;break}return e.next=6,o.disconnect();case 6:throw"This user id already exists with a different key pair. Choose a new user id or paste the correct key pair.";case 7:return e.next=9,o.upsertUsers([{id:t,publicKeyJwk:JSON.stringify(n.publicKeyJwk)}]);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),g=Object(m.a)(p.a.mark((function e(){var t,n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t.publicKey);case 5:return n=e.sent,e.next=8,window.crypto.subtle.exportKey("jwk",t.privateKey);case 8:return r=e.sent,e.abrupt("return",{publicKeyJwk:n,privateKeyJwk:r});case 10:case"end":return e.stop()}}),e)}))),k=function(e){var t=Object(r.useState)(null),n=Object(i.a)(t,2),c=n[0],u=n[1],s=Object(r.useState)(""),o=Object(i.a)(s,2),l=o[0],d=o[1],b=Object(r.useState)(""),f=Object(i.a)(b,2),v=f[0],w=f[1],y=function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=u,e.next=3,g();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.a.createElement("div",null,a.a.createElement("p",null,"What is your id?"),a.a.createElement("input",{value:l,onChange:function(e){return d(e.target.value)}}),a.a.createElement("p",null,"Avoid spaces and special characters."),a.a.createElement("p",null,"Paste your key pair below or ",a.a.createElement("button",{onClick:y},"generate")," a new one."),a.a.createElement("input",{value:JSON.stringify(c),onChange:function(e){try{var t=JSON.parse(e.target.value);u(t)}catch(e){w("Error reading key pair: ".concat(e)),u(c)}}}),a.a.createElement("p",null,"You need to save this key pair somewhere safe if you want to log in with the same user id later."),a.a.createElement("button",{onClick:function(){(function(){var t=Object(m.a)(p.a.mark((function t(){return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,E(l,c);case 3:e.onSubmit({sender:l,keyPair:c}),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),w("Error logging in: ".concat(t.t0));case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}})()()}},"Submit"),a.a.createElement("p",null,v))},x=function(e){var t=Object(r.useState)(""),n=Object(i.a)(t,2),c=n[0],u=n[1],s=Object(r.useState)(""),l=Object(i.a)(s,2),d=l[0],b=l[1];return a.a.createElement("div",null,a.a.createElement("p",null,"Who do you want to chat with?"),a.a.createElement("input",{value:c,onChange:function(e){return u(e.target.value)}}),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement("button",{onClick:function(){(function(){var t=Object(m.a)(p.a.mark((function t(){var n,r;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.queryUsers({id:c});case 3:(n=t.sent).users.length>0?(r=JSON.parse(n.users[0].publicKeyJwk),e.onSubmit({recipient:c,publicKeyJwk:r})):b("This user is not registered. Open a new tab and create it? :)"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),b("Error setting recipient: ".concat(t.t0.message));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}})()()}},"Submit"),a.a.createElement("p",null,d))},O=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("jwk",t,{name:"ECDH",namedCurve:"P-256"},!0,[]);case 2:return r=e.sent,e.next=5,window.crypto.subtle.importKey("jwk",n,{name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]);case 5:return a=e.sent,e.next=8,window.crypto.subtle.deriveKey({name:"ECDH",public:r},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(e){var t=e.sender,n=e.recipient,c=e.onSubmit,u=Object(r.useState)(""),s=Object(i.a)(u,2),o=s[0],l=s[1];return Object(r.useEffect)((function(){(function(){var e=Object(m.a)(p.a.mark((function e(){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O(n.publicKeyJwk,t.keyPair.privateKeyJwk);case 3:r=e.sent,c(r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),l(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[t,n]),a.a.createElement("div",null,a.a.createElement("p",null,"Deriving key..."),a.a.createElement("p",null,o))};var S=function(){var e=Object(r.useState)(null),t=Object(i.a)(e,2),n=t[0],c=t[1],u=Object(r.useState)(null),s=Object(i.a)(u,2),o=s[0],l=s[1],p=Object(r.useState)(null),d=Object(i.a)(p,2),m=d[0],b=d[1];return n?o?m?a.a.createElement(h,{sender:n,recipient:o,derivedKey:m}):a.a.createElement(j,{sender:n,recipient:o,onSubmit:b}):a.a.createElement(x,{onSubmit:l}):a.a.createElement(k,{onSubmit:c})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[180,1,2]]]);
//# sourceMappingURL=main.662889b4.chunk.js.map